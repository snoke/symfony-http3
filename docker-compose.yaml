services:
  gateway:
    build: ./gateway
    environment:
      - RUST_LOG=info
      - WEBTRANSPORT_PORT=4433
      - CERT_PEMFILE=/run/certs/dev_cert.pem
      - KEY_PEMFILE=/run/certs/dev_key.pem
    ports:
      # WebTransport runs over HTTP/3/QUIC (UDP). We map both TCP+UDP for convenience.
      - "8444:4433"
      - "8444:4433/udp"
    volumes:
      - ./certs:/run/certs:ro

  symfony:
    build: ./symfony
    environment:
      - APP_ENV=dev
      - APP_DEBUG=1
      - APP_SECRET=dev-secret
      - WT_URL=https://localhost:8444/
      - WT_CERT_PEMFILE=/run/certs/dev_cert.pem
    ports:
      - "8183:8000"
    volumes:
      - ./certs:/run/certs:ro
